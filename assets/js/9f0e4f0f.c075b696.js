"use strict";(self.webpackChunkpug=self.webpackChunkpug||[]).push([[91],{408:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>l,contentTitle:()=>a,default:()=>h,frontMatter:()=>o,metadata:()=>i,toc:()=>c});const i=JSON.parse('{"id":"Configuration/host-config","title":"Host Network Configuration Documentation","description":"This document explains the network configuration defined in the /etc/network/interfaces file for a Proxmox host.","source":"@site/docs/Configuration/host-config.md","sourceDirName":"Configuration","slug":"/Configuration/host-config","permalink":"/docs/Configuration/host-config","draft":false,"unlisted":false,"editUrl":"https://github.com/GioFed-SAL-Anthem/PUG/edit/main/docs/Configuration/host-config.md","tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"Introduction to PUG","permalink":"/docs/intro"},"next":{"title":"Proxmox VE User Configuration Guide","permalink":"/docs/Configuration/user-config"}}');var r=s(4848),t=s(8453);const o={},a="Host Network Configuration Documentation",l={},c=[{value:"Network Topology",id:"network-topology",level:2},{value:"File Overview",id:"file-overview",level:2},{value:"Configuration Breakdown",id:"configuration-breakdown",level:2},{value:"Network Masquerading (NAT)",id:"network-masquerading-nat",level:2},{value:"Example Port Forwarding Rules (commented out)",id:"example-port-forwarding-rules-commented-out",level:2}];function d(e){const n={code:"code",h1:"h1",h2:"h2",header:"header",hr:"hr",img:"img",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,t.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"host-network-configuration-documentation",children:"Host Network Configuration Documentation"})}),"\n",(0,r.jsxs)(n.p,{children:["This document explains the network configuration defined in the ",(0,r.jsx)(n.code,{children:"/etc/network/interfaces"})," file for a Proxmox host."]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"network-topology",children:"Network Topology"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{alt:"Network Diagram",src:s(3249).A+"",width:"1283",height:"912"})}),"\n",(0,r.jsx)(n.p,{children:"The diagram above shows:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"ens3f0"}),": public-facing NIC with static IP and gateway"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"vmbr0"}),": internal virtual bridge used by VMs"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"10.10.10.0/24"}),": internal subnet for virtual machines"]}),"\n",(0,r.jsxs)(n.li,{children:["NAT and Port Forwarding via ",(0,r.jsx)(n.code,{children:"iptables"})]}),"\n",(0,r.jsx)(n.li,{children:"IP Forwarding and Proxy ARP enabled for routing"}),"\n"]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"file-overview",children:"File Overview"}),"\n",(0,r.jsxs)(n.p,{children:["The configuration manages multiple network interfaces including physical NICs (",(0,r.jsx)(n.code,{children:"ens3f0"}),", ",(0,r.jsx)(n.code,{children:"ens3f1"}),", etc.) and a virtual bridge interface (",(0,r.jsx)(n.code,{children:"vmbr0"}),") used for virtual machine networking. It also includes IP forwarding and NAT setup for routing and port forwarding."]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"configuration-breakdown",children:"Configuration Breakdown"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"auto lo\niface lo inet loopback\nauto lo: Automatically brings up the loopback interface at boot.\n"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"iface lo inet loopback"}),": Defines lo (loopback) interface with IPv4 loopback settings. This interface is used for internal communication within the host."]}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"auto ens3f0\niface ens3f0 inet static \n        address 149.132.176.87/24\n        gateway 149.132.176.1\n\n        # Port Forwarding Rules\n        post-up echo 1 > /proc/sys/net/ipv4/ip_forward\n        post-up echo 1 > /proc/sys/net/ipv4/conf/ens3f0/proxy_arp\n"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"auto ens3f0"}),": Automatically enable the network interface ens3f0 on boot."]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"iface ens3f0 inet static"}),": Configure ens3f0 with a static IP address."]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"address 149.132.176.87/24"}),": Assigns a static IPv4 address with subnet mask /24 (255.255.255.0)."]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"gateway 149.132.176.1"}),": Sets the default gateway for external network access."]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"post-up commands:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"echo 1 > /proc/sys/net/ipv4/ip_forward"}),": Enables IPv4 forwarding at the kernel level, allowing the host to route - packets between interfaces."]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"echo 1 > /proc/sys/net/ipv4/conf/ens3f0/proxy_arp"}),": Enables proxy ARP on ens3f0 allowing the host to respond to ARP requests on behalf of other machines (useful in bridged or NAT setups)."]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"iface ens3f1 inet manual\niface ens3f2 inet manual\niface ens3f3 inet manual\nThese three interfaces (ens3f1, ens3f2, ens3f3) are configured manually without automatic IP assignment.\n"})}),"\n",(0,r.jsx)(n.p,{children:"They are typically used for bridging or other advanced networking setups, or simply kept down until configured."}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"auto vmbr0\niface vmbr0 inet static\n        address 10.10.10.1/24\n        bridge-ports none\n        bridge-stp off\n        bridge-fd 0\n\n        # Network Masquerading Rules\n        post-up   echo 1 > /proc/sys/net/ipv4/ip_forward\n        post-up   iptables -t nat -A POSTROUTING -s '10.10.10.0/24' -o ens3f0 -j MASQUERADE\n        post-down iptables -t nat -D POSTROUTING -s '10.10.10.0/24' -o ens3f0 -j MASQUERADE\n\n        # NATting Rules\n        # EXAMPLE server:10099 to local 10.10.10.99:22\n        #post-up iptables -t nat -A PREROUTING -p tcp -i ens3f0 --dport 10099 -j DNAT --to 10.10.10.99:22\n        #post-down iptables -t nat -D PREROUTING -p tcp -i ens3f0 --dport 10099 -j DNAT --to 10.10.10.99:22\n"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"auto vmbr0"}),": Automatically bring up the bridge interface vmbr0 on boot."]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"iface vmbr0 inet static"}),": Configure vmbr0 with a static IPv4 address."]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"address 10.10.10.1/24"}),": Assigns the bridge IP address within a private subnet (10.10.10.0/24)."]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"bridge-ports none"}),": This bridge has no physical interfaces attached directly to it, commonly used to create an isolated virtual network for VMs."]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"bridge-stp off"}),": Disables Spanning Tree Protocol (STP) to prevent network loops; useful in simple bridge setups."]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"bridge-fd 0"}),": Sets bridge forwarding delay to 0 (immediate forwarding)."]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"network-masquerading-nat",children:"Network Masquerading (NAT)"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"post-up echo 1 > /proc/sys/net/ipv4/ip_forward"}),": Enable IP forwarding for routing packets from the bridge network to the outside network."]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"post-up iptables -t nat -A POSTROUTING -s '10.10.10.0/24' -o ens3f0 -j MASQUERADE"}),": Adds an iptables rule to masquerade (perform NAT) for all traffic from the VM subnet (10.10.10.0/24) going out via ens3f0 (the external network interface)."]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"post-down iptables -t nat -D POSTROUTING -s '10.10.10.0/24' -o ens3f0 -j MASQUERADE"}),": Removes the NAT masquerade rule when the bridge is brought down."]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"example-port-forwarding-rules-commented-out",children:"Example Port Forwarding Rules (commented out)"}),"\n",(0,r.jsx)(n.p,{children:"These are example iptables rules for forwarding external TCP ports to specific IPs inside the VM subnet:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"post-up iptables -t nat -A PREROUTING -p tcp -i ens3f0 --dport 10099 -j DNAT --to 10.10.10.99:22\npost-down iptables -t nat -D PREROUTING -p tcp -i ens3f0 --dport 10099 -j DNAT --to 10.10.10.99:22\n"})}),"\n",(0,r.jsx)(n.p,{children:"Forward TCP connections coming to external interface ens3f0 on port 10099 to internal IP 10.10.10.99 on port 22 (SSH)."}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"source /etc/network/interfaces.d/*\n"})}),"\n",(0,r.jsx)(n.p,{children:"This line includes any additional network interface configurations stored in the /etc/network/interfaces.d/ directory, allowing modular network setups."})]})}function h(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(d,{...e})}):d(e)}},3249:(e,n,s)=>{s.d(n,{A:()=>i});const i=s.p+"assets/images/network-diagram-b3ea8f5ab09d69dbefdb63843e3c79f8.png"},8453:(e,n,s)=>{s.d(n,{R:()=>o,x:()=>a});var i=s(6540);const r={},t=i.createContext(r);function o(e){const n=i.useContext(t);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:o(e.components),i.createElement(t.Provider,{value:n},e.children)}}}]);